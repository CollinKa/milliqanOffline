Tools for extracting the SPE and N<sub>PE</sub> bar calibrations from milliQan data.

The milliQan data is located on the UCSB machines, so this needs to be run there (unless you copy the data somewhere else). I have been running on uafino as the others are very old.

**Big picture:** We require two separate calibrations in each channel:
1. Mean area of a pulse from a single photoelectron (SPE). This is a property of each individual PMT. PMTs of the same type tend to have similar but not identical values.
2. Mean number of photoelectrons generated by a throughgoing particle of a given charge. This depends on the scintillator properties, the scintillator wrappings and couplings to the PMTs, and the PMT quantum efficiencies. Basically, the efficiency of the channel at generating and collecting light from a passing particle.

The SPE area is measured by isolating pulses from late-arriving scintillation photons and finding the peak of the area distribution. The NPE calibration cannot be performed directly, since a throughgoing muon (either beam or cosmic) will saturate the readout. So we take an indirect approach, using the fact that the PMT response scales as a power law. We measure cosmic muon areas at a variety of HV values set low enough that the PMTs do not saturate. We then extrapolate this up to the nominal operating voltage, and divide by the measured mean SPE area to arrive at an estimate of the mean number of PEs generated by the cosmic muon.

**Note:** These scripts only apply to the bars. Slab/panel calibration is performed separately.



## Tutorial

1. First, identify a suitable set of runs to use. You need ~5-6 "cosmic runs", i.e. those set to a low HV so that the PMTs don't saturate. You will also need at least a couple "SPE runs", with HV near the nominal operating voltage. For this tutorial, we use cosmic runs [2620,2617,2616,2614,2611,2609,2608,2604,2599,2588] (each PMT species uses a subset of ~6 of these), and SPE runs [2579,2578,2577,2576,2575,2574,2573,2753,2755,2757,2759] (this is way more SPE runs than you really need, but we use a lot here so we can fit nice power law functions in one of our cross checks).
2. Open up `cfg.py`. Make sure that the channel<->PMT species map at the top is correct. Edit `treeDir` to point to the directory containing the data you want to use for the calibration. If you are using new runs that haven't been used before, you'll have to add them to `tableHV` and hard-code the HVs for each species for that run.
